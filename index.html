<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Darkoak Essentials ‚Äî Docs</title>

  <!-- Favicon -->
  <link rel="icon" type="image/x-icon" href="favicon.ico" />

  <!-- Highlight.js -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/default.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>

  <!-- Marked (Markdown renderer) -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <link rel="stylesheet" href="assets/styles.css">
</head>
<body>
  <div id="app">
    <aside id="sidebar">
      <div class="brand">
        <div class="logo"></div>
        <div>
          <h1>Darkoak Essentials</h1>
          <p class="muted">Addon docs ‚Äî Bedrock Edition</p>
        </div>
      </div>

      <div class="search-wrap">
        <input id="search" placeholder="Search docs..." />
      </div>

      <nav id="nav"></nav>

      <div class="sidebar-footer">
        <!-- ü™µ Download section -->
        <div class="download-card">
          <h3>Latest Release</h3>
          <a 
            id="download-btn" 
            class="btn" 
            href="#" 
            target="_blank"
          >‚¨áÔ∏è Download</a>
          <p class="muted">Fetching latest release...</p>

          <!-- üïê Older Versions button -->
          <a 
            id="older-versions-btn" 
            class="btn secondary-btn" 
            href="older-versions.html"
          >üìú Older Versions</a>
        </div>

        <div class="links">
          <a href="https://github.com/JaxonCore/darkoakessentials" id="github-link" target="_blank">GitHub</a>
          <a href="https://discord.gg/F64Wdw9xU3" id="discord-link" target="_blank">Discord</a>
        </div>
      </div>
    </aside>

    <main id="content-area">
      <header class="topbar">
        <button id="menu-toggle" aria-label="toggle menu">‚ò∞</button>
        <div class="top-title">Darkoak Essentials ‚Äî Documentation</div>
      </header>

      <article id="content" class="markdown-body">Loading‚Ä¶</article>

      <footer class="site-footer">
        <div>¬© <span id="year"></span> Darkoak Essentials</div>
      </footer>
    </main>
  </div>

  <script src="assets/script.js"></script>
  <script>
    hljs.highlightAll();
    document.getElementById('year').textContent = new Date().getFullYear();
  </script>

  <!-- üîÑ Auto-update latest release info -->
  <script>
  async function loadLatestRelease() {
    const repo = "stylithpvp/darkoakessentials";
    const apiUrl = `https://api.github.com/repos/${repo}/releases/addon?nocache=${Date.now()}`;

    try {
      const res = await fetch(apiUrl);
      const data = await res.json();
      const asset = data.assets[0];

      if (asset) {
        // Update download button
        document.getElementById("download-btn").href = asset.browser_download_url;
        document.getElementById("download-btn").textContent = `‚¨áÔ∏è Download ${data.tag_name}`;

        // Update release date + size
        const releaseDate = new Date(data.published_at);
        const month = releaseDate.toLocaleString('default', { month: 'short' });
        const year = releaseDate.getFullYear();
        const sizeMB = (asset.size / 1024 / 1024).toFixed(2);

        document.querySelector(".download-card .muted").textContent = `Released ${month} ${year} ‚Ä¢ ${sizeMB} MB`;
      } else {
        document.querySelector(".download-card .muted").textContent = "No release found.";
      }
    } catch (err) {
      console.error("Error fetching latest release:", err);
      document.querySelector(".download-card .muted").textContent = "Failed to load release info.";
    }
  }

  loadLatestRelease();
  </script>
</body>
</html>
